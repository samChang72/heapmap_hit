!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.HeapMap=e():t.HeapMap=e()}(this,()=>(()=>{"use strict";var t={d:(e,i)=>{for(var n in i)t.o(i,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:i[n]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)},e={};t.d(e,{default:()=>r});const i={getElementSelector(t){if(t.id)return`#${t.id}`;const e=[];let i=t;for(;i&&i!==document.body;){let t=i.tagName.toLowerCase();i.className&&(t+=`.${i.className.split(" ").filter(t=>t).join(".")}`);const n=i.parentElement;if(n){const e=Array.from(n.children).filter(t=>t.tagName===i.tagName);e.length>1&&(t+=`:nth-child(${e.indexOf(i)+1})`)}e.unshift(t),i=i.parentElement}return e.join(" > ")},getElementInfo(t){var e,i;const n=t.getBoundingClientRect(),s=window.getComputedStyle(t);return{tagName:t.tagName.toLowerCase(),id:t.id||null,className:t.className||null,textContent:(null===(e=t.textContent)||void 0===e?void 0:e.trim().substring(0,100))||null,innerHTML:(null===(i=t.innerHTML)||void 0===i?void 0:i.substring(0,200))||null,attributes:this.getElementAttributes(t),selector:this.getElementSelector(t),boundingRect:this.getBoundingRectInfo(n),styles:this.getElementStyles(s)}},getElementAttributes(t){const e={};for(let i=0;i<t.attributes.length;i++){const n=t.attributes[i];n&&(e[n.name]=n.value)}return e},getBoundingRectInfo:t=>({x:Math.round(t.x),y:Math.round(t.y),width:Math.round(t.width),height:Math.round(t.height),top:Math.round(t.top),right:Math.round(t.right),bottom:Math.round(t.bottom),left:Math.round(t.left)}),getElementStyles:t=>({position:t.position,display:t.display,visibility:t.visibility,zIndex:t.zIndex}),getViewportInfo:()=>({width:window.innerWidth,height:window.innerHeight,scrollX:window.pageXOffset||document.documentElement.scrollLeft,scrollY:window.pageYOffset||document.documentElement.scrollTop,userAgent:navigator.userAgent,url:window.location.href,timestamp:(new Date).toISOString()}),getRelativeCoordinates(t,e,i){const n=i.getBoundingClientRect(),s=window.pageXOffset||document.documentElement.scrollLeft,r=window.pageYOffset||document.documentElement.scrollTop;return{x:Math.round(t-n.left-s),y:Math.round(e-n.top-r)}}};class n{constructor(){this.isTracking=!1,this.clickData=[],this.sessionId=this.generateSessionId(),this.clickHandler=this.handleClick.bind(this),this.config={maxDataPoints:1e3,excludeSelectors:[],includeOnlySelectors:[]}}generateSessionId(){return"session_"+Date.now()+"_"+Math.random().toString(36).substring(2,9)}init(t={}){return this.config={...this.config,...t},this}start(){return this.isTracking?(console.warn("ClickTracker: 追蹤已經啟動"),this):(this.isTracking=!0,document.addEventListener("click",this.clickHandler,!0),console.log("ClickTracker: 開始追蹤點擊事件"),this)}stop(){return this.isTracking?(this.isTracking=!1,document.removeEventListener("click",this.clickHandler,!0),console.log("ClickTracker: 停止追蹤點擊事件"),this):(console.warn("ClickTracker: 追蹤尚未啟動"),this)}handleClick(t){try{const e=t.target;if(!e)return;if(this.shouldExcludeElement(e))return;const i=this.collectClickData(t,e);this.addClickData(i),this.dispatchCustomEvent("heapmap:click",i)}catch(t){console.error("ClickTracker: 處理點擊事件時發生錯誤",t)}}collectClickData(t,e){const n=i.getViewportInfo(),s=i.getElementInfo(e),r=i.getRelativeCoordinates(t.pageX,t.pageY,e);return{id:this.generateClickId(),sessionId:this.sessionId,timestamp:(new Date).toISOString(),coordinates:{pageX:t.pageX,pageY:t.pageY,clientX:t.clientX,clientY:t.clientY,screenX:t.screenX,screenY:t.screenY,relative:r},element:s,viewport:n,eventDetails:{type:t.type,button:t.button,buttons:t.buttons,altKey:t.altKey,ctrlKey:t.ctrlKey,metaKey:t.metaKey,shiftKey:t.shiftKey}}}generateClickId(){return"click_"+Date.now()+"_"+Math.random().toString(36).substring(2,9)}addClickData(t){this.clickData.push(t),this.clickData.length>this.config.maxDataPoints&&this.clickData.shift()}shouldExcludeElement(t){if(this.config.excludeSelectors.length>0)for(const e of this.config.excludeSelectors)try{if(t.matches&&t.matches(e))return!0}catch(t){console.warn("ClickTracker: 無效的排除選擇器:",e)}if(this.config.includeOnlySelectors.length>0){let e=!1;for(const i of this.config.includeOnlySelectors)try{if(t.matches&&t.matches(i)){e=!0;break}}catch(t){console.warn("ClickTracker: 無效的包含選擇器:",i)}return!e}return!1}dispatchCustomEvent(t,e){const i=new CustomEvent(t,{detail:e,bubbles:!1,cancelable:!1});document.dispatchEvent(i)}getData(){return[...this.clickData]}getStats(){return{totalClicks:this.clickData.length,sessionId:this.sessionId,isTracking:this.isTracking,firstClick:this.clickData.length>0?this.clickData[0].timestamp:null,lastClick:this.clickData.length>0?this.clickData[this.clickData.length-1].timestamp:null}}clearData(){return this.clickData=[],console.log("ClickTracker: 資料已清除"),this}exportData(){const t={sessionId:this.sessionId,totalClicks:this.clickData.length,exportTime:(new Date).toISOString(),data:this.clickData};return JSON.stringify(t,null,2)}setConfig(t){return this.config={...this.config,...t},this}getConfig(){return{...this.config}}}const s=new class{constructor(){this.version="1.0.0",this.clickTracker=new n}init(t={}){return this.clickTracker.init(t),console.log(`HeapMap SDK v${this.version} 已初始化`),this}start(){return this.clickTracker.start(),this}stop(){return this.clickTracker.stop(),this}getData(){return this.clickTracker.getData()}getStats(){return this.clickTracker.getStats()}clearData(){return this.clickTracker.clearData(),this}exportData(t="json"){if("json"===t.toLowerCase())return this.clickTracker.exportData();throw new Error(`不支援的匯出格式: ${t}`)}setConfig(t){return this.clickTracker.setConfig(t),this}getConfig(){return this.clickTracker.getConfig()}on(t,e){const i=`heapmap:${t}`;return document.addEventListener(i,e),this}off(t,e){const i=`heapmap:${t}`;return document.removeEventListener(i,e),this}getVersion(){return this.version}getDOMUtils(){return i}};"undefined"!=typeof window&&(window.HeapMap=s);const r=s;return e.default})());
//# sourceMappingURL=heapmap.js.map